<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
	<title>Dynatree - Example</title>

	<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/mint-choc/jquery-ui.css" 
		rel="stylesheet" type="text/css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" type="text/javascript"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1/jquery-ui.min.js" type="text/javascript"></script>

	<link href="../src/skin/ui.dynatree.css" rel="stylesheet" type="text/css">
	<script src="../src/jquery.dynatree.js" type="text/javascript"></script>

	<!-- Start_Exclude: This block is not part of the sample code -->
	<link href="../lib/prettify.css" rel="stylesheet">
	<script src="../lib/prettify.js" type="text/javascript"></script>
	<link href="../demo/sample.css" rel="stylesheet" type="text/css">
	<script src="../demo/sample.js" type="text/javascript"></script>
	<!-- End_Exclude -->
	<style type="text/css">
	</style>
	<!-- Add code to initialize the tree when the document is loaded: -->
	<script type="text/javascript">
	$(function(){
		// Attach the dynatree widget to an existing <div id="tree"> element
		// and pass the tree options as an argument to the dynatree() function:
		$("#tree").dynatree({
			extensions: ["table"],
			source: {
				url: "unit/ajax-tree.json"
			},
			activate: function(e, data) {
			}
		});
	});
    function insertSiblingAfter(referenceNode, newNode) {
       referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);
    }
    $.ui.dynatree.registerExtension("table", {
        // Default options for this extension.
        options: {
        },
        // Overide virtual methods for this extension.
        // `this`       : is this extension object
        // `this._base` : the Dynatree instance
        // `this._super`: the virtual function that was overriden (member of prev. extension or Dynatree)
        treeInit: function(ctx){
    		var tree = ctx.tree,
    			tr;
    		tree.tbody = $("table#treetable tbody")[0];
    		tree.columnCount = 3; //$(">tr", tree
            $(tree.tbody).empty();
    		tree.rowFragment = document.createDocumentFragment();
			tr = document.createElement("tr"); 
			tree.rowFragment.appendChild(tr);
			for(var i=0; i<tree.columnCount; i++) {
				tr.appendChild(document.createElement("td"));
			}
            this._super(ctx);
//            $(ctx.tree.rootNode.ul).addClass("role-tree");
        },
        nodeRender: function(ctx){
            this._super(ctx);
    		var tree = ctx.tree,
    			node = ctx.node,
                opts = ctx.options,
                tmp;
    		if(!node.tr){
    			// Create new <tr> after previous row
    			var parentNode = node.parent,
    				prevNode = node.getPrevSibling(), 
                    newRow = tree.rowFragment.firstChild.cloneNode(true);
                if(!prevNode){
                    if(!parentNode.parent){
                        // first top-level node
                        if(tree.tbody.hasChildNodes()){
//                            tree.tbody.childNodes[0].insertBefore(newRow);
                            tmp = tree.tbody.insertBefore(newRow, tree.tbody.firstChild);
                        }else{
                            tmp = tree.tbody.appendChild(newRow);
                        }
                    }else{
                        prevNode = parentNode.children ? parentNode.getLastChild() : parentNode;
                    }
    			}
                if(prevNode){
//                    _assert(prevNode.tr);
                    tmp = insertSiblingAfter(prevNode.tr, newRow);
                }
                node.tr = newRow;
                node.tr.id = opts.idPrefix + node.key;
    		}
//            $(node.tr).html("<td>" + node.title + "</td> <td>" + node.key + "</td> <td>" + node.folder + "</td>")
            $("td:first", node.tr).text(node.title)
//            $(ctx.node.li).addClass("role-treeitem");
        }
     });	
	</script>
</head>
<body class="example">
	<h1>Example: column simulation</h1>
	<p class="description">
		This sample shows, how titles could displayed as aligned columns.
	</p>

	<!-- Add a <div> element where the tree should appear: -->
	<div id="tree"> </div>
	<table id="treetable">
		<colgroup>
		<col width="200px"></col>
		<col width="200px"></col>
		<col width="200px"></col>
		</colgroup>
		<thead>
			<tr> <td>a</td> <td>b</td> <td>c</td> </tr>
		</thead>
		<tbody>
			<tr> <td></td> <td></td> <td></td> </tr>
		</tbody>
	</table>
	<!-- Start_Exclude: This block is not part of the sample code -->
	<hr>
	<p class="sample-links  no_code">
		<a class="hideInsideFS" href="http://dynatree.googlecode.com">jquery.dynatree.js project home</a>
		<a class="hideOutsideFS" href="#">Link to this page</a>
		<a class="hideInsideFS" href="samples.html">Example Browser</a>
		<a href="#" id="codeExample">View source code</a>
	</p>
	<pre id="sourceCode" class="prettyprint" style="display:none"></pre>
	<!-- End_Exclude -->
</body>
</html>
